# grep

- find를 통해 파일의 이름과 경로를 검색했다면,
- grep을 통해서는 파일의 내부를 검색하고 찾으려는 정보를 출력한다.
- `grep "patten" file` 로 사용된다
    - `grep "chicken" animal.txt` 와 같이 사용된다
    - chicken을 강조하고(다른색) 들어간 행을 모두 출력한다.
    - 대소문자를 구분한다
    - 파일이 아닌 것에도 사용 가능하다.

## 옵션

> `grep option "pattern" file/location` 로 사용할 수 있다.

- `-i`
    - 대소문자를 구분하지 않도록 한다.
- `-w`
    - 정확히 일치하는 단어를 찾는다.
- `-r`
    - 재귀 옵션으로, 현재 위치한 디렉토리를 기점으로 이 안에 있는 모든 파일과 디렉토리를 검사한다.
    - 어떤 파일인지 모를때 사용하는 방법으로 파일 내부에 특정 키워드로 검색할 수 있다.
- `-c`
    - 패턴이 몇회 나왔는지 찾을 수 있다(갯수를 센다)
- `-B` + `number`
    - ex) `-B1`
    - 전의 내용을 1행 출력한다.
- `-A` + `number`
    - ex) `-A1`
    - 앞의 내용을 1행 출력한다.
- `-C` + `number`
    -ex) `-C2`
    - 앞 뒤 2행씩 출력한다.
- `-n`
    - 찾은 것이 몇행인지 출력한다.
- `-m` + `number`
    - ex) `-m3`
    - 결과의 갯수 제한(예시의 경우 3개 출력)

## 정규표현식(regex)

- grep의 강점은 정규 표현식을 허용하는 것이다.

### **1. 리터럴 매칭**
- 단순히 문자열을 검색.
```bash
grep "text" file.txt
```

### **2. 메타문자**
정규 표현식의 특수 문자는 아래와 같다. 이를 매칭하려면 \ 로 이스케이프해야 한다.

| 메타문자 | 설명 |
|----------|------|
| `.`      | 임의의 단일 문자와 매칭 |
| `^`      | 문자열의 시작을 지정 |
| `$`      | 문자열의 끝을 지정 |
| `*`      | 앞 문자가 0번 이상 반복 |
| `+`      | 앞 문자가 1번 이상 반복 (확장 정규 표현식) |
| `?`      | 앞 문자가 0번 또는 1번 등장 (확장 정규 표현식) |
| `[]`     | 문자 클래스. 대괄호 안의 문자 중 하나와 매칭 |
| `[^]`    | 부정된 문자 클래스. 대괄호 안의 문자 외의 문자와 매칭 |
| `{}`     | 반복 횟수를 지정 (확장 정규 표현식) |
| `|`      | OR 연산자 (확장 정규 표현식) |
| `()`     | 그룹핑 (확장 정규 표현식) |

---

## 주요 패턴과 사용 예제

### **1. 시작(^)과 끝($) 패턴**
- **라인의 시작**: `^`를 사용.
```bash
grep "^hello" file.txt
```
- **라인의 끝**: `$`를 사용.
```bash
grep "world$" file.txt
```

### **2. 임의의 문자(.)**
- `.`은 모든 단일 문자와 매칭.
```bash
grep "h.t" file.txt
```

### **3. 문자 클래스([])**
- 대괄호 안의 문자 중 하나와 매칭.
```bash
grep "h[aeiou]t" file.txt
```
- 문자 범위 지정 가능:
```bash
grep "[a-z]" file.txt
```

### **4. 부정된 문자 클래스([^])**
- 대괄호 안에 `^`를 넣어 특정 문자를 제외.
```bash
grep "[^aeiou]" file.txt
```

### **5. 반복(*, +, ?)**
- `*`: 앞 문자가 0번 이상 반복.
```bash
grep "he*llo" file.txt
```
- `+`: 앞 문자가 1번 이상 반복 (**확장 정규 표현식**).
```bash
grep -E "he+llo" file.txt
```
- `?`: 앞 문자가 0번 또는 1번 등장 (**확장 정규 표현식**).
```bash
grep -E "he?llo" file.txt
```

### **6. 반복 횟수({})**
- `{n}`: 정확히 n번 반복.
- `{n,}`: 최소 n번 반복.
- `{n,m}`: n번 이상, m번 이하 반복.
```bash
grep -E "a{3}" file.txt
```

### **7. OR(|)**
- `|`로 여러 패턴 중 하나를 매칭 (**확장 정규 표현식**).
```bash
grep -E "cat|dog" file.txt
```

### **8. 그룹핑(())**
- `()`로 패턴을 그룹화.
```bash
grep -E "(ab)+" file.txt
```

### 예시

- 21~26 이후 4행을 출력하기
    - `grep -A4 "2[1-6]" SongOfMyself.txt`
    - `grep -A4 "2[123456]" SongOfMyself.txt` 같은 동작을 한다.
- bird 와 birds 모두 검색하기
    - `grep -wE "birds?" SongOfMyself.txt`
    - `-E` 옵션으로 확장 정규식을 사용할 수 있다. 
    - `-E` 옵션에서 물음표(?)를 표시하려면 이스케이프 문자 \를 사용해야 한다. 예를 들어, E 옵션에서 \?를 사용하면  물음표가 표시된다.
    - `s?` 부분은 0또는 1번 등장을 찾는다.
    - `-E` 옵션을 사용하면 기본 정규식(BRE)에서 확장 정규식(ERE)으로 바꿔서 +, ?, {}, | 등의 메타문자들을 그 기능에 맞게 사용할 수 있다.
    - 기본 정규식에서는 이들 메타문자들이 문자로 취급되는 반면, 확장 정규식에서는 실제로 특별한 의미를 갖는다.
- 대문자로 쓰여진 5개 검색
    - `grep -w [A-Z]{5} SongofMySelf.txt`
    - {n} 는 앞 문자를 n회 반복한다
    - ex) a{3} 은 aaa와 같다.
- 소문자로 쓰여진 2~4개 검색
    - `grep -w [a-z]{2,4} SongOfMyself.txt`

## grep 파이프 연결

### 예제

-  `ps -aux` 를 입력했을때 나오는 것중 sound가 포함된 것을 찾기
    - `ps -aux` 는 현재 모든 사용자가 사용하고 있는 프로세스를 출력한다
    - `ps -aux | grep "sound"` 로 찾을 수 있다.
- 어떤 사용자의 파일이면서, .txt로 끝나고, 비어있지 않으며, 디렉토리가 아닌 것 찾기
    - `find ~ -empty -type f -name "*.txt"`
- 홈에서 URL이 들어간 것들 전부 찾기
    - `gunha@oracle:~$ grep -rE "https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)" ~ -I`
    - 모든 URL을 찾을 수 있는 정규식
    - `-I` 는 grep이 텍스트 파일로 간주되지 않는 이진 파일을 만나면 검색하지 않고 무시하도록 한다.